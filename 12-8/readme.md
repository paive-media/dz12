# Домашнее задание к занятию 12.8 "Резервное копирование баз данных"

---

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надежность работы БД и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1 Необходимо восстанавливать данные в полном объеме за предыдущий день.
- *инкрементальное, например по заданию на 01:00*

1.2 Необходимо восстанавливать данные за час до предполагаемой поломки.
- *инкрементальноое за сутки и разностное/дифференциально ежечасно*

1.3* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую/починеную БД?
- *да, можно настроить репликацию на 1 или несколько SLAVE-серверов, тогда внутренние механизмы СУБД будут устанавливать новый MASTER из доступных.*


---

### Задание 2. PostgreSQL

2.1 С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).
```sh
-- создание бэкапа
pg_dump -U db_user -W db_pass > /tmp/db_backup_file_timestamp.dump

-- восстановление из бэкапа
pg_restore -d db_name /tmp/db_backup_file_timestamp.dump
```

2.1* Возможно ли автоматизировать этот процесс? Если да, то как?

*Можно создать `sh-скрипт` и настроить задание в `crontab` для регулярного запуска.*

*Можно настроить репликацию, тогда внутренние механизмы СУБД будут устанавливать новый MASTER из доступных.*

---

### Задание 3. MySql

3.1 С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySql.

Должен быть настроен `log_bin` в `/etc/my.cnf`
```sh
mysql> SHOW BINARY LOGS;
mysql> SHOW MASTER STATUS;
$> mysqlbinlog binlog_files | mysql -u root -p
```

3.1* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

- Когда есть ресурсы на отдельные ВМ/сервера для SLAVE-нод;
- Когда есть ресурсы на диагностику работоспособности репликации между нодами;
- Когда мощность SLAVE-нод выше, чем MASTER-ноды;
- Когда есть задача разделения нагрузки на чтение и на запись между нодами;
- Когда важно скорость переключения на рабочую ноду при выходе из строя текущего MASTER

